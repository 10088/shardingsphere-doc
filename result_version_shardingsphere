1,3c1,3
< commit fa2b7f7862b26b8a312c4b97dd691370dc2624e3
< Author: kimmking <kimmking@163.com>
< Date:   Tue Nov 17 23:33:44 2020 +0800
---
> commit 72229a4c8a3d3fbf08fa92c6ccec136746188143
> Author: JingShang Lu <lujingshang@apache.org>
> Date:   Wed Nov 18 11:12:45 2020 +0800
5c5
<     remove dataSourceCommon configurations (#8192)
---
>     improve SQL Parser doc (#8138)
7c7
<     * remove dataSourceCommon in proxy
---
>     * improve SQL Parser doc
9c9
<     * remove dataSourceCommon in distribution
---
>     * fix
11c11
<     * remove dataSourceCommon in examples
---
>     * fix
13c13,15
<     * remove dataSourceCommon in docs
---
>     * fix
>     
>     * fix
15,179c17,192
< diff --git a/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.cn.md b/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.cn.md
< index d0349e2a52..ec94c74b79 100644
< --- a/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.cn.md
< +++ b/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.cn.md
< @@ -12,26 +12,14 @@ ShardingSphere-JDBC 提供官方的 Spring Boot Starter，使开发者可以非
<  ```properties
<  spring.shardingsphere.datasource.names= # 数据源名称，多数据源以逗号分隔
<  
< -spring.shardingsphere.datasource.common.type=  # 数据库连接池类名称
< -spring.shardingsphere.datasource.common.driver-class-name= # 数据库驱动类名
< -spring.shardingsphere.datasource.common.username= # 数据库用户名
< -spring.shardingsphere.datasource.common.password= # 数据库密码
< -spring.shardingsphere.datasource.common.xxx=  # 数据库连接池的其它属性
< -
< -spring.shardingsphere.datasource.<datasource-name>.url= # 数据库 URL 连接
< -```
< -
< -## 覆盖数据源 common 配置
< -```properties
<  spring.shardingsphere.datasource.<datasource-name>.url= # 数据库 URL 连接
< -spring.shardingsphere.datasource.<datasource-name>.type= # 数据库连接池类名称，覆盖 common 中的 type 配置
< -spring.shardingsphere.datasource.<datasource-name>.driver-class-name= # 数据库驱动类名，覆盖 common 中的 driver-class-name 配置
< -spring.shardingsphere.datasource.<datasource-name>.username= # 数据库用户名 ，覆盖 common 中的 username 配置
< -spring.shardingsphere.datasource.<datasource-name>.password= # 数据库密码 ，覆盖 common 中的 password 配置
< -spring.shardingsphere.datasource.<data-source-name>.xxx= # 数据库连接池的其它属性 ，覆盖 common 中其他属性配置
< +spring.shardingsphere.datasource.<datasource-name>.type=  # 数据库连接池类名称
< +spring.shardingsphere.datasource.<datasource-name>.driver-class-name= # 数据库驱动类名
< +spring.shardingsphere.datasource.<datasource-name>.username= # 数据库用户名
< +spring.shardingsphere.datasource.<datasource-name>.password= # 数据库密码
< +spring.shardingsphere.datasource.<datasource-name>.xxx=  # 数据库连接池的其它属性
<  ```
<  
< -
<  ## 规则配置
<  
<  ```properties
< diff --git a/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.en.md b/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.en.md
< index d5de199e71..8f23d72a9e 100644
< --- a/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.en.md
< +++ b/docs/document/content/user-manual/shardingsphere-jdbc/configuration/spring-boot-starter/_index.en.md
< @@ -12,23 +12,12 @@ ShardingSphere-JDBC provides official Spring Boot Starter to make convenient for
<  ```properties
<  spring.shardingsphere.datasource.names= # Data source name, multiple data sources are separated by commas
<  
< -spring.shardingsphere.datasource.common.type= # Database connection pool type name
< -spring.shardingsphere.datasource.common.driver-class-name= # Database driver class name
< -spring.shardingsphere.datasource.common.username= # Database username
< -spring.shardingsphere.datasource.common.password= # Database password
< -spring.shardingsphere.datasource.common.xxx= # Other properties of database connection pool
< -
< -spring.shardingsphere.datasource.<datasource-name>.url= # Database URL connection
< -```
< -
< -## Override Data Source Common Configuration
< -```properties
<  spring.shardingsphere.datasource.<datasource-name>.url= # Database URL connection
< -spring.shardingsphere.datasource.<datasource-name>.type= # Database connection pool type name，Override common type property
< -spring.shardingsphere.datasource.<datasource-name>.driver-class-name= # Database driver class name，Override common driver-class-name property
< -spring.shardingsphere.datasource.<datasource-name>.username= # Database username ，Override common username property
< -spring.shardingsphere.datasource.<datasource-name>.password= # Database password ，Override common password property
< -spring.shardingsphere.datasource.<data-source-name>.xxx= # Other properties of database connection pool ，Override common other property
< +spring.shardingsphere.datasource.<datasource-name>.type= # Database connection pool type name
< +spring.shardingsphere.datasource.<datasource-name>.driver-class-name= # Database driver class name
< +spring.shardingsphere.datasource.<datasource-name>.username= # Database username
< +spring.shardingsphere.datasource.<datasource-name>.password= # Database password
< +spring.shardingsphere.datasource.<datasource-name>.xxx= # Other properties of database connection pool
<  ```
<  
<  ## Rule Configuration
< diff --git a/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.cn.md b/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.cn.md
< index 1df8a85ccf..90c18599fd 100644
< --- a/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.cn.md
< +++ b/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.cn.md
< @@ -7,34 +7,18 @@ weight = 1
<  
<  ```yaml
<  schemaName: # 逻辑数据源名称
< -dataSourceCommon:
< -  username: # 数据库用户名
< -  password: # 数据库密码
< -  connectionTimeoutMilliseconds: # 连接超时毫秒数
< -  idleTimeoutMilliseconds: # 空闲连接回收超时毫秒数
< -  maxLifetimeMilliseconds: # 连接最大存活时间毫秒数
< -  maxPoolSize: 50 # 最大连接数
< -  minPoolSize: 1  # 最小连接数
<  
<  dataSources: # 数据源配置，可配置多个 <data-source-name>
<    <data-source-name>: # 与 ShardingSphere-JDBC 配置不同，无需配置数据库连接池
<      url: #数据库 URL 连接
< +    username: # 数据库用户名
< +    password: # 数据库密码
< +    connectionTimeoutMilliseconds: # 连接超时毫秒数
< +    idleTimeoutMilliseconds: # 空闲连接回收超时毫秒数
< +    maxLifetimeMilliseconds: # 连接最大存活时间毫秒数
< +    maxPoolSize: 50 # 最大连接数
< +    minPoolSize: 1  # 最小连接数     
< +
<  rules: # 与 ShardingSphere-JDBC 配置一致
<    # ...
<  ```
< -
< -## 覆盖dataSourceCommon说明
< -
< -上面配置了每个库的公共数据源配置，如果你想覆盖 `dataSourceCommon` 属性，请在每个数据源单独配置。
< -
< -```yaml
< -dataSources: # 数据源配置，可配置多个 <data-source-name>
< -  <data-source-name>: # 与 ShardingSphere-JDBC 配置不同，无需配置数据库连接池
< -    url: #数据库 URL 连接
< -    username: # 数据库用户名，覆盖 dataSourceCommon 配置
< -    password: # 数据库密码，覆盖 dataSourceCommon 配置
< -    connectionTimeoutMilliseconds: # 连接超时毫秒数，覆盖 dataSourceCommon 配置
< -    idleTimeoutMilliseconds: # 空闲连接回收超时毫秒数，覆盖 dataSourceCommon 配置
< -    maxLifetimeMilliseconds: # 连接最大存活时间毫秒数，覆盖 dataSourceCommon 配置
< -    maxPoolSize: # 最大连接数，覆盖 dataSourceCommon 配置
< -```
< diff --git a/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.en.md b/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.en.md
< index 7f8280e63a..3ab45cc9b1 100644
< --- a/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.en.md
< +++ b/docs/document/content/user-manual/shardingsphere-proxy/configuration/data-source.en.md
< @@ -7,35 +7,18 @@ weight = 1
<  
<  ```yaml
<  schemaName: # Logic schema name
< -dataSourceCommon:
< -  username: # Database username
< -  password: # Database password
< -  connectionTimeoutMilliseconds: #Connection timeout milliseconds
< -  idleTimeoutMilliseconds: #Idle timeout milliseconds
< -  maxLifetimeMilliseconds: #Maximum life milliseconds
< -  maxPoolSize: 50 #Maximum connection count in the pool
< -  minPoolSize: 1  #Minimum connection count in the pool
<  
<  dataSources: # Data sources configuration, multiple <data-source-name> available
<    <data-source-name>: # Different from ShardingSphere-JDBC configuration, it does not need to be configured with database connection pool
<      url: # Database URL
< +    username: # Database username
< +    password: # Database password
< +    connectionTimeoutMilliseconds: #Connection timeout milliseconds
< +    idleTimeoutMilliseconds: #Idle timeout milliseconds
< +    maxLifetimeMilliseconds: #Maximum life milliseconds
< +    maxPoolSize: 50 #Maximum connection count in the pool
< +    minPoolSize: 1  #Minimum connection count in the pool        
< +
<  rules: # Keep consist with ShardingSphere-JDBC configuration
<    # ...
<  ```
< -
< -## Override dataSourceCommon Configuration
< -
< -If you want to override the 'dataSourceCommon' property, configure it separately for each data source.
< -
< -```yaml
< -dataSources: # Data sources configuration, multiple <data-source-name> available
< -  <data-source-name>: # Different from ShardingSphere-JDBC configuration, it does not need to be configured with database connection pool
< -     url: # Database URL
< -     username: # Database username ,Override dataSourceCommon username property
< -     password: # Database password ,Override dataSourceCommon password property
< -     connectionTimeoutMilliseconds: #Connection timeout milliseconds ,Override dataSourceCommon connectionTimeoutMilliseconds property
< -     idleTimeoutMilliseconds: #Idle timeout milliseconds ,Override dataSourceCommon idleTimeoutMilliseconds property
< -     maxLifetimeMilliseconds: #Maximum life milliseconds ,Override dataSourceCommon maxLifetimeMilliseconds property
< -     maxPoolSize: 50 #Maximum connection count in the pool ,Override dataSourceCommon maxPoolSize property
< -     minPoolSize: 1  #Minimum connection count in the pool ,Override dataSourceCommon minPoolSize property
< -```
< \ No newline at end of file
---
> diff --git a/docs/document/content/features/sharding/principle/parse.cn.md b/docs/document/content/features/sharding/principle/parse.cn.md
> index 6c9e42945d..63bd9cb353 100644
> --- a/docs/document/content/features/sharding/principle/parse.cn.md
> +++ b/docs/document/content/features/sharding/principle/parse.cn.md
> @@ -10,7 +10,7 @@ weight = 1
>  
>  解析过程分为词法解析和语法解析。
>  词法解析器用于将 SQL 拆解为不可再分的原子符号，称为 Token。并根据不同数据库方言所提供的字典，将其归类为关键字，表达式，字面量和操作符。
> -再使用语法解析器将 SQL 转换为抽象语法树。
> +再使用语法解析器将 词法解析器的输出 转换为抽象语法树。
>  
>  例如，以下 SQL：
>  
> @@ -24,13 +24,15 @@ SELECT id, name FROM t_user WHERE status = 'ACTIVE' AND age > 18
>  
>  为了便于理解，抽象语法树中的关键字的 Token 用绿色表示，变量的 Token 用红色表示，灰色表示需要进一步拆分。
>  
> -最后，通过对抽象语法树的遍历去提炼分片所需的上下文，并标记有可能需要改写的位置。
> +最后，通过`visitor`对抽象语法树遍历构造域模型，通过域模型(`SQLStatement`)去提炼分片所需的上下文，并标记有可能需要改写的位置。
>  供分片使用的解析上下文包含查询选择项（Select Items）、表信息（Table）、分片条件（Sharding Condition）、自增主键信息（Auto increment Primary Key）、排序信息（Order By）、分组信息（Group By）以及分页信息（Limit、Rownum、Top）。
>  SQL 的一次解析过程是不可逆的，一个个 Token 按 SQL 原本的顺序依次进行解析，性能很高。
>  考虑到各种数据库 SQL 方言的异同，在解析模块提供了各类数据库的 SQL 方言字典。
>  
>  ## SQL 解析引擎
>  
> +### 历史
> +
>  SQL 解析作为分库分表类产品的核心，其性能和兼容性是最重要的衡量指标。
>  ShardingSphere 的 SQL 解析器经历了 3 代产品的更新迭代。
>  
> @@ -39,4 +41,65 @@ ShardingSphere 的 SQL 解析器经历了 3 代产品的更新迭代。
>  第二代 SQL 解析器从 1.5.x 版本开始，ShardingSphere 采用完全自研的 SQL 解析引擎。
>  由于目的不同，ShardingSphere 并不需要将 SQL 转为一颗完全的抽象语法树，也无需通过访问器模式进行二次遍历。它采用对 SQL `半理解`的方式，仅提炼数据分片需要关注的上下文，因此 SQL 解析的性能和兼容性得到了进一步的提高。
>  
> -第三代 SQL 解析器从 3.0.x 版本开始，尝试使用 ANTLR 作为 SQL 解析引擎，并采用 Visit 的方式从 AST 中获取 SQL Statement。从5.0.x 版本开始，解析引擎的架构已完成重构调整，同时通过将第一次解析的得到的 AST 放入缓存，方便下次直接获取相同  SQL的解析结果，来提高解析效率。 因此我们建议用户采用 `PreparedStatement` 这种 SQL 预编译的方式来提升性能。当前，用户还可以独立使用 ShardingSphere 的 SQL 解析引擎，获得多款主流关系型数据库的 AST 及 SQL Statement。 未来，SQL 解析引擎将继续提供 SQL 格式化、 SQL 模板化等强大的功能。
> +第三代 SQL 解析器从 3.0.x 版本开始，尝试使用 ANTLR 作为 SQL 解析引擎 的生成器，并采用 Visit 的方式从 AST 中获取 SQL Statement。从5.0.x 版本开始，解析引擎的架构已完成重构调整，同时通过将第一次解析的得到的 AST 放入缓存，方便下次直接获取相同  SQL的解析结果，来提高解析效率。 因此我们建议用户采用 `PreparedStatement` 这种 SQL 预编译的方式来提升性能。
> +
> +### 功能点
> +
> +* 提供独立的SQL解析功能
> +* 可以非常方便的对语法规则进行扩充和修改(使用了`ANTLR`)
> +* 支持多种方言的SQL解析
> +
> +| 数据库    | 支持状态 |
> +|----------|--------|
> +|MySQL     |支持，完善|
> +|PostgreSQL|支持，完善|
> +|SQLServer |支持     |
> +|Oracle    |支持     |
> +|SQL92     |支持     |
> +* 提供SQL格式化功能（开发中）
> +* 提供SQL模板话功能（开发中）
> +
> +### API使用
> +
> +引入Maven依赖
> +```
> +<dependency>
> +    <groupId>org.apache.shardingsphere</groupId>
> +    <artifactId>shardingsphere-sql-parser-engine</artifactId>
> +    <version>${project.version}</version>
> +</dependency>
> +// 根据需要引入指定方言的解析模块（以MySQL为例）,可以添加所有支持的方言，也可以只添加使用到的
> +<dependency>
> +    <groupId>org.apache.shardingsphere</groupId>
> +    <artifactId>shardingsphere-sql-parser-mysql</artifactId>
> +    <version>${project.version}</version>
> +</dependency>
> +```
> +
> +例子
> +
> +- 获取语法树
> +
> +```
> +/**
> + * databaseType type:String 可能值 MySQL,Oracle，PostgreSQL，SQL92，SQLServer
> + * sql type:String 解析的SQL
> + * useCache type:boolean 是否使用缓存
> + * @return parse tree
> + */
> +ParseTree tree = new SQLParserEngine(databaseType).parse(sql, useCache); 
> +```
> +
> +- 获取SQLStatement
> +
> +```
> +/**
> + * databaseType type:String 可能值 MySQL,Oracle，PostgreSQL，SQL92，SQLServer
> + * useCache type:boolean 是否使用缓存
> + * @return SQLStatement
> + */
> +ParseTree tree = new SQLParserEngine(databaseType).parse(sql, useCache); 
> +SQLVisitorEngine sqlVisitorEngine = new SQLVisitorEngine(databaseType, "STATEMENT");
> +SQLStatement sqlStatement = sqlVisitorEngine.visit(tree);
> +
> +```
> diff --git a/docs/document/content/features/sharding/principle/parse.en.md b/docs/document/content/features/sharding/principle/parse.en.md
> index 40af146c5d..e4d4ed3f78 100644
> --- a/docs/document/content/features/sharding/principle/parse.en.md
> +++ b/docs/document/content/features/sharding/principle/parse.en.md
> @@ -25,10 +25,73 @@ At last, through traversing the abstract syntax tree, the context needed by shar
>  
>  ## SQL Parser
>  
> +### History
> +
>  As the core of database sharding and table sharding, SQL parser takes the performance and compatibility as its most important index. ShardingSphere SQL parser has undergone the upgrade and iteration of 3 generations of products.
>  
>  To pursue good performance and quick achievement, the first generation of SQL parser uses `Druid` before 1.4.x version. As tested in practice, its performance exceeds other parsers a lot.
>  
>  The second generation of SQL parsing engine begins from 1.5.x version, ShardingSphere has adopted fully self-developed parsing engine ever since. Due to different purposes, ShardingSphere does not need to transform SQL into a totally abstract syntax tree or traverse twice through visitor. Using `half parsing` method, it only extracts the context required by data sharding, so the performance and compatibility of SQL parsing is further improved.
>  
> -The third generation of SQL parsing engine begins from 3.0.x version. ShardingSphere tries to adopts ANTLR as the SQL parsing engine, and uses Visit to obtain SQL Statement from AST. Starting from version 5.0.x, the architecture of the parsing engine has been refactored. At the same time, it is convenient to directly obtain the parsing results of the same SQL to improve parsing efficiency by putting the AST obtained from the first parsing into the cache. Therefore, we recommend that users adopt `PreparedStatement` this SQL pre-compilation method to improve performance. Currently, users can also use ShardingSphere's SQL parsing engine independently to obtain AST and SQL Statements for a variety of mainstream relational databases. In the future, the SQL parsing engine will continue to provide powerful functions such as SQL formatting and SQL templating.
> +The third generation of SQL parsing engine begins from 3.0.x version. ShardingSphere tries to adopts ANTLR as a generator for the SQL parsing engine, and uses Visit to obtain SQL Statement from AST. Starting from version 5.0.x, the architecture of the parsing engine has been refactored. At the same time, it is convenient to directly obtain the parsing results of the same SQL to improve parsing efficiency by putting the AST obtained from the first parsing into the cache. Therefore, we recommend that users adopt `PreparedStatement` this SQL pre-compilation method to improve performance. Currently, users can also use ShardingSphere's SQL parsing engine independently to obtain AST and SQL Statements for a variety of mainstream relational databases. In the future, the SQL parsing engine will continue to provide powerful functions such as SQL formatting and SQL templating.
> +
> +### Features
> +
> +* Independent SQL parsing engine
> +* The syntax rules can be easily expanded and modified (using `ANTLR`)
> +* Support multiple dialects
> +
> +| DB    | Status |
> +|----------|--------|
> +|MySQL     |supported|
> +|PostgreSQL|supported|
> +|SQLServer |supported|
> +|Oracle    |supported|
> +|SQL92     |supported|
> +
> +* SQL format (developing)
> +* SQL parameterize (developing)
> +
> +### API Usage
> +
> +Maven config
> +```
> +<dependency>
> +    <groupId>org.apache.shardingsphere</groupId>
> +    <artifactId>shardingsphere-sql-parser-engine</artifactId>
> +    <version>${project.version}</version>
> +</dependency>
> +// According to the needs, introduce the parsing module of the specified dialect (take MySQL as an example), you can add all the supported dialects, or just what you need
> +<dependency>
> +    <groupId>org.apache.shardingsphere</groupId>
> +    <artifactId>shardingsphere-sql-parser-mysql</artifactId>
> +    <version>${project.version}</version>
> +</dependency>
> +```
> +
> +demo:
> +
> +- Get AST
> +
> +```
> +/**
> + * databaseType type:String values: MySQL,Oracle，PostgreSQL，SQL92，SQLServer
> + * sql type:String SQL to be parsed
> + * useCache type:boolean whether use cache
> + * @return parse tree
> + */
> +ParseTree tree = new SQLParserEngine(databaseType).parse(sql, useCache)
> +```
> +
> +- GET SQLStatement
> +
> +```
> +/**
> + * databaseType type:String values: MySQL,Oracle，PostgreSQL，SQL92，SQLServer
> + * useCache type:boolean whether use cache
> + * @return SQLStatement
> + */
> +ParseTree tree = new SQLParserEngine(databaseType).parse(sql, useCache); 
> +SQLVisitorEngine sqlVisitorEngine = new SQLVisitorEngine(databaseType, "STATEMENT");
> +SQLStatement sqlStatement = sqlVisitorEngine.visit(tree);
> +```
