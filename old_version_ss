commit 435c8ffb6334d8c321720c481136f0ca8e996921
Author: lanchengx <52209337+lanchengx@users.noreply.github.com>
Date:   Thu Nov 4 10:06:58 2021 -0500

    [DistSQL] Support `alter sharding algorithm` statement (#13424)
    
    * Support `alter sharding algorithm` statement
    
    * Add `alter sharding algorithm` test
    
    * Add doc.
    
    * Modify doc.
    
    * Update rdl-sharding-rule.cn.md
    
    * Update rdl-sharding-rule.en.md
    
    * Update rdl-sharding-rule.cn.md
    
    * Update rdl-sharding-rule.en.md
    
    * Update rdl-sharding-rule.cn.md
    
    * Update rdl-sharding-rule.en.md
    
    * Update rdl-sharding-rule.cn.md
    
    * Update rdl-sharding-rule.en.md
    
    * Update alter.xml
    
    * Update alter.xml

diff --git a/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.cn.md b/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.cn.md
index f335c53c11..c870a43091 100644
--- a/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.cn.md
+++ b/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.cn.md
@@ -18,6 +18,8 @@ DROP SHARDING TABLE RULE tableName [, tableName] ...
 
 CREATE SHARDING ALGORITHM shardingAlgorithmDefinition [,  shardingAlgorithmDefinition] ...
 
+ALTER SHARDING ALGORITHM shardingAlgorithmDefinition [,  shardingAlgorithmDefinition] ...
+
 DROP SHARDING ALGORITHM algorithmName [, algorithmName] ...
 
 shardingTableRuleDefinition:
@@ -124,21 +126,21 @@ SHARDING_COLUMN=order_id,
 TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=4)),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 ),t_order_item (
-DATANODES("resource_${0..1}.t_order${0..1}"),
+DATANODES("resource_${0..1}.t_order_item_${0..1}"),
 DATABASE_STRATEGY(TYPE=standard,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM=database_inline),
-TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=database_inline),
+TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=table_inline),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 );
 
 ALTER SHARDING TABLE RULE t_order (
-RESOURCES(resource_0,resource_1),
+RESOURCES(resource_0,resource_1,resource_2,resource_3),
 SHARDING_COLUMN=order_id,
-TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=10)),
+TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=16)),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 ),t_order_item (
-DATANODES("resource_0.t_order${0..1}"),
+DATANODES("resource_${0..3}.t_order_item${0..3}"),
 DATABASE_STRATEGY(TYPE=standard,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM=database_inline),
-TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=database_inline),
+TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=table_inline),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=uuid,PROPERTIES("worker-id"=123)))
 );
 
@@ -148,8 +150,16 @@ CREATE DEFAULT SHARDING DATABASE STRATEGY (
 TYPE = standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=algorithmsName
 );
 
-CREATE SHARDING ALGORITHM algorithmName (
-TYPE(NAME=hash_mod,PROPERTIES("algorithm-expression"="t_order_${order_id % 2}"))
+CREATE SHARDING ALGORITHM database_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${user_id % 2}"))
+),table_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${order_id % 2}"))
+);
+
+ALTER SHARDING ALGORITHM database_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${user_id % 4}"))
+),table_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${order_id % 4}"))
 );
 
 DROP SHARDING ALGORITHM t_order_hash_mod;
diff --git a/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.en.md b/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.en.md
index ad203c94cd..a6c4bac54f 100644
--- a/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.en.md
+++ b/docs/document/content/user-manual/shardingsphere-proxy/usage/distsql/syntax/rdl/rdl-sharding-rule.en.md
@@ -18,6 +18,8 @@ DROP SHARDING TABLE RULE tableName [, tableName] ...
 
 CREATE SHARDING ALGORITHM shardingAlgorithmDefinition [,  shardingAlgorithmDefinition] ...
 
+ALTER SHARDING ALGORITHM shardingAlgorithmDefinition [,  shardingAlgorithmDefinition] ...
+
 DROP SHARDING ALGORITHM algorithmName [, algorithmName] ...
 
 shardingTableRuleDefinition:
@@ -124,21 +126,21 @@ SHARDING_COLUMN=order_id,
 TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=4)),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 ),t_order_item (
-DATANODES("resource_${0..1}.t_order${0..1}"),
+DATANODES("resource_${0..1}.t_order_item_${0..1}"),
 DATABASE_STRATEGY(TYPE=standard,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM=database_inline),
-TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=database_inline),
+TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=table_inline),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 );
 
 ALTER SHARDING TABLE RULE t_order (
-RESOURCES(resource_0,resource_1),
+RESOURCES(resource_0,resource_1,resource_2,resource_3),
 SHARDING_COLUMN=order_id,
-TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=10)),
+TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=16)),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=snowflake,PROPERTIES("worker-id"=123)))
 ),t_order_item (
-DATANODES("resource_0.t_order${0..1}"),
+DATANODES("resource_${0..3}.t_order_item_${0..3}"),
 DATABASE_STRATEGY(TYPE=standard,SHARDING_COLUMN=user_id,SHARDING_ALGORITHM=database_inline),
-TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=database_inline),
+TABLE_STRATEGY(TYPE=standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=table_inline),
 GENERATED_KEY(COLUMN=another_id,TYPE(NAME=uuid,PROPERTIES("worker-id"=123)))
 );
 
@@ -148,8 +150,16 @@ CREATE DEFAULT SHARDING DATABASE STRATEGY (
 TYPE = standard,SHARDING_COLUMN=order_id,SHARDING_ALGORITHM=algorithmsName
 );
 
-CREATE SHARDING ALGORITHM algorithmName (
-TYPE(NAME=hash_mod,PROPERTIES("algorithm-expression"="t_order_${order_id % 2}"))
+CREATE SHARDING ALGORITHM database_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${user_id % 2}"))
+),table_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${order_id % 2}"))
+);
+
+ALTER SHARDING ALGORITHM database_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${user_id % 4}"))
+),table_inline (
+TYPE(NAME=inline,PROPERTIES("algorithm-expression"="resource_${order_id % 4}"))
 );
 
 DROP SHARDING ALGORITHM t_order_hash_mod;
